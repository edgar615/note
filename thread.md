线程池大小设置

http://ifeve.com/how-to-calculate-threadpool-size/

	最佳线程数目 = （（线程等待时间+线程CPU时间）/线程CPU时间 ）* CPU数目
	
比如平均每个线程CPU运行时间为0.5s，而线程等待时间（非CPU运行时间，比如IO）为1.5s，CPU核心数为8，那么根据上面这个公式估算得到：((0.5+1.5)/0.5)*8=32。这个公式进一步转化为：

	最佳线程数目 = （线程等待时间与线程CPU时间之比 + 1）* CPU数目
	
可以得出一个结论：**线程等待时间所占比例越高，需要越多线程。线程CPU时间所占比例越高，需要越少线程。**

**Java并发实战**中的描述：

对于计算密集型的任务，一个有Ncpu 个处理器的系统通常通过使用一个Ncpu +1个线程的线程池来获得最优的利用率（计算密集型的线程恰好在某时因为发生一个页错误或者因为其他原因而暂停，刚好有一个“额外”的线程，可以确保在这样的情况下CPU周期不会中断工作）。对于包含了I/O和其他阻塞操作的任务，不是所有的线程都会在所有的时间被调度，因此你需要一个更大的池。为了正确地设置线程池的长度，你必须估算出任务花在等待的时间与用来计算的时间的比率；这个估算值不必十分精确，而且可以通过一些监控工具获得。你还可以选择另一种方法来调节线程池的大小，在一个基准负载下，使用不同大小的线程池运行你的应用程序，并观察CPU利用率的水平。

给定下列定义：

	Ncpu = CPU的数量
	Ucpu = 目标CPU的使用率，0 ≤ Ucpu≤ 1
	W/C = 等待时间与计算时间的比率

为保持处理器达到期望的使用率，最优的池的大小等于：

	Nthreads = Ncpu * Ucpu * ( 1 + W/C )

可以使用Runtime来获得CPU的数目：

	int N_CPUS = Runtime.getRuntime().availableProcessors();

CPU周期并不是唯一可以使用线程池管理的资源。其他可以约束资源池大小的资源包括：内存、文件句柄、套接字句柄和数据库连接等。计算这些资源池的大小约束非常简单：首先累加出每一个任务需要的这些资源的总量，然后除以可用的总量。所得的结果是池大小的上限