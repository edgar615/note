陈老师教的

1.正常情况下， 门店库存以本地服务器为准， 并且在发生变更后立即更新到总部服务器，在网络中断的情况下，暂存本地，待网络恢复后立即同步；(不能直接覆盖，否则是脏写，应该告诉销售变化)

2.总部服务器，与该门店相关库存正常情况下使用表中数据， 如果门店服务器与总部服务器断线后， 在3小时内按照  历史库存/2计算,  如果结果小于3， 直接库存为0 （防止超卖）
3.反向同步库存， 总部库存与门店库存之间同步， 采用消息通知方式进行， 由本地进行库存核实，如果出现负库存，则调用总部服务器的调拨流程接口

总部服务器中的库存设计采用虚拟库存，   而门店服务器则是实体库存

总部走了销售流程， 减了库存，生成了订单， 这时候门店系统接受指令关联订单， 这个总部只是推给消息队列了。门店订阅总部的消息，进行订单处理

门店销售：可以是消息， 也可以直接调接口，如果网络中断，必然是消息，但是是写入本地的消息队列，然后网络恢复以后，重取消息调用接口
如果你规模小， 也可以让总部订阅门店消息，但是一般门店的带宽很垃圾， 所以不建议这种场景用消息订阅模式

