公司定义的消息格式，用于平台间交互

# 消息格式
消息格式为JSON格式，所有字符编码均为UTF-8格式。消息格式分为消息头和消息体。

- **head** JSON对象，表示消息头部各种属性
- **data** JSON对象，表示消息头部各种属性，常为用户自定义消息内容

# 消息头
消息头字段定义了消息的ID，发送信道，接收信道，组信道，消息活动等各种信息。消息头字段是消息的关键内容。

- **to** 消息接收者信道，在kafka中为消息的主题 
- **action** 消息活动，用于区分不同的消息类型
- **id** 消息id，唯一值
- **timestamp** 消息产生Unix时间戳
- **duration** 消息的有效时间，单位秒。例如对于短信验证码内的消息，在处理时超过了duration设置的时间，就不需要再处理了。默认为-1，表示永不过期。
- 其他自定义的扩展字段

## 约定
**所有的消息主题（to）应该使用版本号开始**，版本号使用整数递增如：v1.xxx，v2.xxx
我们将消息划分为两种
### 动作
动作表示一次请求，要求消息接受者执行一次动作，这个消息一般只能有一个消费者。**在消息主题中使用job作为前缀，用一个动词作为结束**，如

	v1.job.sms.send表示一次短信发送的请求。

### 事件
事件表示系统完成了某个操作/请求，这个消息可以有多个消费者订阅，多个消费者可以格式针对这个时间进行后续的处理。**在消息主题中使用event作为前缀，用一个过去分词作为结束**，如

	v1.event.sms.sended表示一次短信发送的结果。


## 消息活动
消息活动有下面几种类型

- 消息：message
- 请求消息：request
- 请求回应：response
- 抢占式消息：signal
- 抢占式回应：ack
- 链路控制消息：control
- 链路控制回应：answer

目仅实现的Message类型，其他的类型待有需要时再实现
# 消息内容
消息内容为JSON格式文本，如果消息中存在二进制数据需要进行base64编码为文本串。消息体的编码格式为UTF-8，对于不同的action，消息内容格式不同。

## 消息 message
单向消息，不需要接收方（或者是消息订阅方）回应

- **resource** string 资源标识，用于同一个主题中消息的分类，我们可以把topic看作，resource看作对象中的方法
- **content** JSON对象，请求参数

## 请求消息 request
请求消息表示消息发送端向接收端发起一个功能请求，消息内容的格式：

- **resource** string 资源标识
- **operation** 操作类型
- **content** JSON对象，请求参数

request可以用来实现RPC调用，用resource表示接口，用operation表示方法，用content表示参数。

## 请求回应 response
请求回应为请求消息的回应

- **result** int 0-成功 非0-失败
- **reply** 回应所对应请求的消息ID
- **content** JSON对象，回应结果

如果回应的result是非0，回应的结果应该事先约定好的错误格式

## 抢占式消息 signal

抢占式消息针对集群使用，消息发送者对一个集群发送组信道发送signal消息，集群中的任何可接受的服务应答响应。消息发送者任意选择一个集群实例发送其他消息。

- **action** 抢占式活动
- **content** JSON对象，活动对应的请求数据，需要携带真实的请求有效验证的数据

## 抢占式回应 ack

- **isolate** 0表示组应答，1表示孤立应答（不必等待其他应答）
- **priority** 0-100之间的优先级（越大优先级越高）
- **compute** 0-100之间的性能负载数据（越大服务计算负载越高）
- **time** 0-100之间的时间负载数据（越大表示服务响应越慢）
- **io** 0-100之间的IO负载数据（越大表示IO越慢）
- **payload** 0-100之间的综合负载数据（越大表示服务负载越高）

## 链路控制消息（control）
链路控制消息表示信道间的链路参数设置。
- **command** 控制命令
- **action** 命令针对的活动（all表示全部活动）
- **content** JSON对象，活动对应的请求数据，需要携带真实的请求有效验证的数据

控制命令及参数如下表所示：
-  **timeout** 时间（毫秒）-1表示无超时控制
-  **retransmit** 次数，-1表示不重传重传次数设置
-  **split** 将一个信道拆分为多个信道
-  **join** 将多个信道和并为一个信道
-  **fragment** 超过阀值后消息将分片  

